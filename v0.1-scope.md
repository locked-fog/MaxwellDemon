# Maxwell Demon v0.1 Scope（最终验收目标）

## 0. 决策锁定

- `v0.1` 定义为第一个可发布版本，不是 Demo，不做范围缩减。
- 不设开发时间上限，以“功能完整 + 可发布质量”为唯一优先级。
- 本文是最终验收基线。与 `Vibe-README.md` 有冲突时，以本文为准。

## 1. v0.1 发布定义（Definition of Release）

只有同时满足以下条件，`v0.1` 才视为“可发布”：

1. 新玩家可从新档完成完整闭环：探索区块 -> 建产线 -> 推进科技/政策 -> 交易/合同 -> 触发剧情 T0-T4 -> 完成终局 -> 执行转生。
2. 六大界面全部可用且互通：地图、区块面板、工作流编辑器、科技树、政策树、交易/商人。
3. 存档系统稳定：可保存、读档、导入/导出、版本迁移。
4. 没有阻断发布的缺陷（见第 7 节的缺陷分级）。

## 2. 功能范围与验收标准

### 2.1 地图与区块系统（必须完整）

- 六边形地图可渲染、可点击、可解锁新区块。
- 每个区块必须具备：地形、资源禀赋、容量、邻接关系、区块库存、区块图状态。
- 区块间物流实现邻格抽取，按固定顺序分配（顺时针优先），受区块出口容量限制。

验收标准：

- 可在地图界面操作区块解锁与进入区块。
- 区块库存会因图内产线与跨区块物流变化。
- 相同初始存档下，跨区块抽取顺序和结果可复现。

### 2.2 工作流编辑器（必须完整）

- 支持节点新增、拖拽、连线、删除、参数编辑。
- 支持节点类型：`extractor`、`processor`、`storage`、`power_gen`、`control`、`port_in`、`port_out`、`market`、`research`。
- 图状态可持久化到存档。

验收标准：

- 可在 UI 中完成一条从输入到输出的有效产线搭建。
- 非法连线会被阻止或给出错误提示。
- 节点显示运行状态灯：`running` / `stalled`（含原因）。
- 连线可查看“当前流量/容量”。

### 2.3 模拟核心（sim）与可复现性（必须完整）

- tick 流程严格遵循文档顺序：电力汇总 -> 节点处理 -> 连线传输 -> 端口库存交互 -> 跨区块抽取。
- 节点停机原因至少覆盖：`no_input`、`no_power`、`output_full`、`disabled`。
- 宏观变量生效：`macroEntropy`、`imagEnergy`、`collapsePressure`。

验收标准：

- 同一存档、同一输入序列下，结果一致（确定性）。
- 可观察到宏观变量对效率/事件的影响。
- 至少跑通 `extractor -> processor -> storage` 与含 `power_gen` 的完整链路。

### 2.4 进度系统（科技 + 政策）必须完整

- 科技树不少于 50 项（`>=50`），含前置、成本、解锁效果。
- 政策树不少于 30 项（`>=30`），至少 3 条主线，且每项有代价与效果。
- 解锁与效果必须真实影响 sim 或可建内容，不允许“仅展示不生效”。

验收标准：

- 科技/政策可在 UI 中查看、解锁、即时生效。
- 前置条件校验正确。
- 效果在 sim 指标上有可观测变化。

### 2.5 交易系统（商人 + 日常/周常 + 合同）必须完整

- 本地市场常驻可买卖。
- 商人系统在 T2 解锁后可用，含有限库存和价格波动。
- 日常任务按现实日刷新，周常任务按现实周刷新。
- 合同按“游戏日窗口”交付，违约扣信誉和罚金。

验收标准：

- 玩家可通过交易与任务获得关键稀缺资源。
- 刷新机制与信誉机制可持续运行，不会刷爆或卡死。
- 合同履约/违约结果准确写入存档。

### 2.6 剧情阶段（T0-T4）与转生系统（必须完整）

- 剧情采用“阶段事件 + 系统解锁”模式覆盖 T0 到 T4。
- T4 提供三条终局路线：热寂航行 / 悖论封存 / 递归播种（转生）。
- 转生触发条件、资源消耗、结算与重置完整可运行。
- `memoryShards` 等 meta 资源能跨周目保留并解锁增益。

验收标准：

- 从新档可推进到 T4 并触发终局选择。
- 转生后世界重置与 meta 保留行为符合设计。
- 转生后开局加成可见并可验证生效。

### 2.7 存档系统（必须完整）

- 存档必须覆盖：时间、地图区块、图状态、科技、政策、交易、剧情触发记录、meta 资源。
- 提供 IndexedDB 持久化与版本化 base64 导入/导出（支持复制到剪贴板和导出到文件）。
- 必须带 `saveVersion`，并有迁移入口（至少有可执行的迁移骨架）。

验收标准：

- 刷新页面后状态可恢复。
- 导出的 base64 存档串可再次导入并恢复同等状态。
- 旧版本存档加载时会执行迁移，不崩溃。

### 2.8 数据驱动（必须完整）

- 数据文件至少包含：`resources.json`、`nodeTypes.json`、`recipes.json`、`techs.json`、`policies.json`、`traders.json`、`quests_daily.json`、`quests_weekly.json`、`story_events.json`。
- 每个条目至少具备：`id`、`name`、`desc`，并具备可用于分组的字段（`tags` / `era` / `track`）。
- 业务逻辑不写死在 UI，统一由 sim/规则层解释数据。

验收标准：

- 替换或扩展 JSON 后，系统可读入并运行（在合法数据前提下）。
- 非法数据有明确错误提示，不默默失败。

## 3. 工程质量验收标准

1. TypeScript `strict` 保持开启并通过编译。
2. `features/sim` 不得依赖任何 UI 代码。
3. 无失控 `any`（仅允许在参数入口处校验后收敛）。
4. `npm run lint`、`npm run test`、`npm run build` 全通过。
5. 核心测试要求包含：
6. sim 核心单测覆盖关键规则（tick 顺序、堵塞、断电、跨区块抽取、宏观变量影响）。
7. 存档/迁移测试覆盖导入导出与版本迁移。
8. 至少一条端到端“黄金路径”测试从开局到转生可跑通。

## 4. 玩法完整性验收（黄金路径）

以下流程必须能从新档完整跑通：

1. 进入地图并解锁第一个新区块。
2. 进入区块并搭建基础产线。
3. 产线稳定运行，状态灯与流量显示正确。
4. 通过科技解锁新节点或新配方。
5. 通过政策获得加成并承受对应代价。
6. 区块间物流生效，解决关键缺料。
7. T2 后启用商人与任务系统。
8. 接取并完成合同，处理信誉变化。
9. 推进剧情至 T3/T4。
10. 触发终局工程并完成至少一条结局。
11. 执行转生并获得 `memoryShards`。
12. 新周目开局可见并可验证 meta 加成。

## 5. 发布打包与文档验收

- 提供可运行生产包（Web 版）。
- 提供玩家文档：新手引导、存档说明、已知限制。
- 提供开发文档：目录结构、数据格式、迁移机制、测试命令。
- 提供版本说明：核心功能、平衡假设、后续计划。

## 6. 可接受的“非阻断项”

以下问题可在 `v0.1.x` 修复，不阻断首次发布：

- UI 视觉不够精美，但信息传达清晰且交互稳定。
- 数值平衡不完美，但不存在明显死档或软锁。
- 非核心动画或特效缺失。

## 7. 缺陷分级与发布门槛

- `P0`：崩溃、存档损坏、无法进入核心流程、转生/结局不可达。存在任一 `P0` 禁止发布。
- `P1`：核心系统结果错误（例如交易结算错误、政策不生效、剧情阶段卡死）。存在未关闭 `P1` 禁止发布。
- `P2`：有替代路径的缺陷或体验问题。可带少量上线，但必须记录修复计划。

---

## 8. 执行约束（团队工作方式）

- 一切开发任务必须可映射到本文某条验收条款。
- 新增需求若超出本文，先更新本文再开发。
- 每个功能合入前必须给出“对应验收条款 + 测试证据”。
